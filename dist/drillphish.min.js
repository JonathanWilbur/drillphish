!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){e.exports=o(1)},function(e,t,o){"use strict";function n(e,t){try{return parseInt(e)}catch(e){return t}}const r="__DRILLPHISH_ACCOUNT_ID__",i="__DRILLPHISH_USERNAME_FIELD_SELECTOR__",s="__DRILLPHISH_PASSWORD_FIELD_SELECTOR__",l="__DRILLPHISH_FORM_SELECTOR__",a="__DRILLPHISH_WEBHOOK_URI__",c="__DRILLPHISH_REDIRECT_URI__",u=n("__DRILLPHISH_DAYS_BETWEEN_REARMING_PAGE__",1),d=n("__DRILLPHISH_DAYS_OF_VICTIM_ID_PERSISTENCE__",365),_=new Boolean(n("__DRILLPHISH_TESTING__",0)).valueOf();var I;function h(){document.querySelectorAll("input").forEach(e=>{e.setAttribute("disabled","disabled")})}function D(){document.querySelectorAll("form").forEach(e=>{e.reset()})}function f(e){const t=window.localStorage.getItem(e);if(t)return t;console.debug(`DrillPhish could not find '${e}' stored with window.localStorage.`);const o=window.sessionStorage.getItem(e);if(o)return o;console.debug(`DrillPhish could not find a '${e}' stored with window.sessionStorage.`);const n=function(e){const t=new RegExp(`${e}=([^;]+)`).exec(document.cookie);return t?decodeURIComponent(t[1]):null}(e);return n||(console.debug(`DrillPhish could not find a '${e}' stored with document.cookie.`),null)}function L(e,t,o=1){window.localStorage.setItem(e,t),window.sessionStorage.setItem(e,t),function(e,t,o){const n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3),document.cookie=`${e}=${encodeURIComponent(t)};expires ${n.toUTCString};path=/;`}(e,encodeURIComponent(t),o),console.debug(`Stored '${e}' in persistent storage.`)}function E(e,t){if(t.victimID=w,t.event=e,t.timestamp=(new Date).toISOString(),t.protocol=window.location.protocol,t.hostname=window.location.hostname,t.port=window.location.port,t.pathname=window.location.pathname,t.search=window.location.search,t.hash=window.location.hash,t.href=window.location.href,t.DRILLPHISH_ACCOUNT_ID=r,t.DRILLPHISH_USERNAME_FIELD_SELECTOR=i,t.DRILLPHISH_PASSWORD_FIELD_SELECTOR=s,t.DRILLPHISH_FORM_SELECTOR=l,t.DRILLPHISH_WEBHOOK_URI=a,t.DRILLPHISH_REDIRECT_URI=c,t.DRILLPHISH_DAYS_BETWEEN_REARMING_PAGE=u,t.DRILLPHISH_DAYS_OF_VICTIM_ID_PERSISTENCE=d,t.DRILLPHISH_TESTING=_,t.browserCodeName=navigator.appCodeName,t.browserName=navigator.appName,t.browserVersion=navigator.appVersion,t.cookiesEnabled=navigator.cookieEnabled,t.browserLanguage=navigator.language,t.platform=navigator.platform,t.userAgent=navigator.userAgent,""===a)return void console.debug(`DrillPhish is not using a webhook. DrillPhish would have reported this event: ${JSON.stringify(t)}.`);const o=new XMLHttpRequest;o.addEventListener("load",()=>{o.status<200||o.status>=300?console.warn(`DrillPhish failed to communicate with the webhook endpoint with HTTP status ${o.status}.`):console.debug(`DrillPhish reported event type ${e}.`)}),o.open("POST",a,!0),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(t))}function S(){if(console.info("Victim fell for the DrillPhish phishing drill."),L("DRILLPHISH_GOTCHA_TIME",(new Date).toISOString(),u),""!==c)_?confirm("Click 'OK' to be redirected to the DRILLPHISH_REDIRECT_URI. Click 'Cancel' to stay on this page.")&&(window.location.href=c):window.location.href=c;else{console.warn("DrillPhish is not configured to redirect. User will stay on current page and see an alert instead.");const e=(()=>""!==a?"You actions have been recorded and sent to a remote endpoint. ":"")();alert(`You have fallen for a phishing drill created by DrillPhish. This is a fake website. ${e}`),E(4,{})}}function R(e){return`__${e}__`}!function(e){e[e.DRILLPHISH_LOAD=0]="DRILLPHISH_LOAD",e[e.WINDOW_LOAD=1]="WINDOW_LOAD",e[e.DATA_ENTERED=2]="DATA_ENTERED",e[e.FORM_SUBMITTED=3]="FORM_SUBMITTED",e[e.ALERT_ACKNOWLEDGED=4]="ALERT_ACKNOWLEDGED"}(I||(I={})),console.debug("DrillPhish found."),console.assert(r!==R("DRILLPHISH_ACCOUNT_ID")),console.assert(i!==R("DRILLPHISH_USERNAME_FIELD_SELECTOR")),console.assert(s!==R("DRILLPHISH_PASSWORD_FIELD_SELECTOR")),console.assert(l!==R("DRILLPHISH_FORM_SELECTOR")),console.assert(a!==R("DRILLPHISH_WEBHOOK_URI")),console.assert(c!==R("DRILLPHISH_REDIRECT_URI"));const p=function(){const e=f("DRILLPHISH_GOTCHA_TIME");return e?function(e){const t=e.split(/\D+/);return new Date(Date.UTC(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]),parseInt(t[3]),parseInt(t[4]),parseInt(t[5]),parseInt(t[6])))}(e):null}();if(p&&!_){const e=Math.abs((new Date).getTime()-p.getTime());Math.floor(e/864e5)<u&&(h(),D(),window.location.href=c)}const w=function(){const e=f("DRILLPHISH_VICTIM_ID");return e||Math.random().toString(36).replace("0.","")}();console.assert(""!==w),L("DRILLPHISH_VICTIM_ID",w,d),console.info(`Using DrillPhish Victim ID ${w} and Account ID ${r}.`),E(0,{}),window.onload=(()=>{console.debug("DrillPhish loaded."),E(1,{});const e=""===l?(console.warn("No form selector set for DrillPhish. The form will not be policed for submission."),null):document.querySelector(l);if(e){const t=e.cloneNode(!0);e.parentNode&&e.parentNode.replaceChild(t,e),t.addEventListener("submit",e=>{e.preventDefault(),E(3,{eventTarget:(()=>e.srcElement?e.srcElement.outerHTML:"")(),selectionTarget:t.outerHTML}),h(),D(),S()}),console.debug("DrillPhish is watching the form element for submission events.")}else""!==l&&console.warn(`Failed to find the form element watched by DrillPhish, given the selector '${l}'. Phishing drill may fail.`);const t=""===i?(console.warn("No username selector set for DrillPhish. The username field will not be policed for input."),null):document.querySelector(i),o=""===s?(console.warn("No password selector set for DrillPhish. The password field will not be policed for input."),null):document.querySelector(s);console.assert(!(!e&&!t&&!o),"Selectors given to DrillPhish found no elements to watch. DrillPhish exiting."),t?(t.addEventListener("blur",e=>{E(2,{eventTarget:(()=>e.srcElement?e.srcElement.outerHTML:"")(),selectionTarget:t.outerHTML,username:(()=>t.value)()})}),console.debug("DrillPhish is watching the username field for input events.")):""!==i&&console.warn(`Failed to find the username element watched by DrillPhish, given the selector "${i}". Phishing drill may fail.`),o?(o.addEventListener("input",e=>{E(2,{eventTarget:(()=>e.srcElement?e.srcElement.outerHTML:"")(),selectionTarget:o.outerHTML,username:(()=>t?t.value:"")()}),h(),D(),S()}),console.debug("DrillPhish is watching the password field for input events.")):""!==s&&console.warn(`Failed to find the password element watched by DrillPhish, given the selector "${s}". Phishing drill may fail.`)})}]);